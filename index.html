<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HM Follow Up System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .blink {
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-700 p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">HM Follow Up System</h1>
                <p class="text-gray-600 mt-2">Track and manage customer tickets efficiently</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" id="username" name="username" required 
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" name="password" required 
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <button type="submit" 
                            class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Login
                    </button>
                </div>
            </form>
            <div id="loginError" class="mt-4 text-red-500 text-sm hidden"></div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-ticket-alt text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">HM Follow Up System</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="currentUser" class="text-gray-700 font-medium"></span>
                    <button id="logoutBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
            <!-- Navigation Tabs -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex space-x-8">
                    <button id="createTicketTab" class="border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Create New Ticket
                    </button>
                    <button id="searchTicketTab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Search Tickets
                    </button>
                    <button id="adminTab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm hidden">
                        Admin Panel
                    </button>
                </nav>
            </div>

            <!-- Create Ticket Section -->
            <div id="createTicketSection" class="slide-in">
                <div class="bg-white shadow rounded-lg p-6 mb-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Create New Ticket</h2>
                    <form id="ticketForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="ticketNumber" class="block text-sm font-medium text-gray-700 mb-1">Ticket Number*</label>
                                <input type="text" id="ticketNumber" name="ticketNumber" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p id="ticketError" class="mt-1 text-sm text-red-600 hidden">This ticket number already exists</p>
                            </div>
                            <div>
                                <label for="accountName" class="block text-sm font-medium text-gray-700 mb-1">Account Name*</label>
                                <input type="text" id="accountName" name="accountName" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="platform" class="block text-sm font-medium text-gray-700 mb-1">Platform*</label>
                                <select id="platform" name="platform" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Platform</option>
                                    <option value="X">X (Twitter)</option>
                                    <option value="Instagram">Instagram</option>
                                    <option value="Email">Email</option>
                                    <option value="Phone Call">Phone Call</option>
                                </select>
                            </div>
                            <div>
                                <label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                <input type="text" id="phoneNumber" name="phoneNumber" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="ticketDate" class="block text-sm font-medium text-gray-700 mb-1">Ticket Date*</label>
                                <input type="date" id="ticketDate" name="ticketDate" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="openTime" class="block text-sm font-medium text-gray-700 mb-1">Open Time*</label>
                                <input type="time" id="openTime" name="openTime" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" 
                                    class="w-full md:w-auto bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                Create Ticket
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Recent Tickets Table -->
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-medium text-gray-900">Recent Tickets</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket #</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Account</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Platform</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Open Time</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Close Time</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">6h</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">24h</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">48h</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ticketsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Tickets will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            Showing <span id="startCount">1</span> to <span id="endCount">10</span> of <span id="totalCount">0</span> tickets
                        </div>
                        <div class="flex space-x-2">
                            <button id="prevPage" class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                                Previous
                            </button>
                            <button id="nextPage" class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                                Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Ticket Section -->
            <div id="searchTicketSection" class="hidden slide-in">
                <div class="bg-white shadow rounded-lg p-6 mb-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Search Tickets</h2>
                    <form id="searchForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="searchTicketNumber" class="block text-sm font-medium text-gray-700 mb-1">Ticket Number</label>
                                <input type="text" id="searchTicketNumber" name="searchTicketNumber" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="searchPhoneNumber" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                <input type="text" id="searchPhoneNumber" name="searchPhoneNumber" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="searchAccountName" class="block text-sm font-medium text-gray-700 mb-1">Account Name</label>
                                <input type="text" id="searchAccountName" name="searchAccountName" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div class="pt-2">
                            <button type="submit" 
                                    class="w-full md:w-auto bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                Search
                            </button>
                            <button type="button" id="resetSearch" 
                                    class="w-full md:w-auto ml-2 bg-gray-200 text-gray-800 py-2 px-6 rounded-md hover:bg-gray-300 transition duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                                Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Search Results Table -->
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h2 class="text-lg font-medium text-gray-900">Search Results</h2>
                        <button id="exportSearchResults" class="text-sm bg-green-600 text-white py-1 px-3 rounded-md hover:bg-green-700 flex items-center">
                            <i class="fas fa-file-excel mr-2"></i> Export to Excel
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket #</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Account</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Platform</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Open Time</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Close Time</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">6h</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">24h</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">48h</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="searchResultsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Search results will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 text-center text-sm text-gray-500" id="noResultsMessage">
                        No search results yet. Enter your criteria and click Search.
                    </div>
                </div>
            </div>

            <!-- Admin Panel Section -->
            <div id="adminPanelSection" class="hidden slide-in">
                <div class="bg-white shadow rounded-lg p-6 mb-6">
                    <h2 class="text-lg font-medium text-gray-900 mb-4">Admin Panel</h2>
                    
                    <!-- User Management -->
                    <div class="mb-8">
                        <h3 class="text-md font-medium text-gray-900 mb-3">User Management</h3>
                        <form id="addUserForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="newUsername" class="block text-sm font-medium text-gray-700 mb-1">Username*</label>
                                    <input type="text" id="newUsername" name="newUsername" required 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">Password*</label>
                                    <input type="password" id="newPassword" name="newPassword" required 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label for="userRole" class="block text-sm font-medium text-gray-700 mb-1">Role*</label>
                                    <select id="userRole" name="userRole" required 
                                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Select Role</option>
                                        <option value="agent">Agent</option>
                                        <option value="admin">Admin</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="pt-2">
                                <button type="submit" 
                                        class="w-full md:w-auto bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                    Add User
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Import Tickets -->
                    <div class="mb-8">
                        <h3 class="text-md font-medium text-gray-900 mb-3">Import Historical Tickets</h3>
                        <form id="importTicketsForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Excel File*</label>
                                <div class="mt-1 flex items-center">
                                    <input type="file" id="ticketsFile" name="ticketsFile" accept=".xlsx, .xls" required 
                                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <p class="mt-1 text-sm text-gray-500">Upload an Excel file with historical tickets data</p>
                            </div>
                            
                            <div class="pt-2">
                                <button type="submit" 
                                        class="w-full md:w-auto bg-green-600 text-white py-2 px-6 rounded-md hover:bg-green-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                                    Import Tickets
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Export All Tickets -->
                    <div>
                        <h3 class="text-md font-medium text-gray-900 mb-3">Export All Tickets</h3>
                        <button id="exportAllTickets" 
                                class="w-full md:w-auto bg-green-600 text-white py-2 px-6 rounded-md hover:bg-green-700 transition duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                            <i class="fas fa-file-excel mr-2"></i> Export to Excel
                        </button>
                    </div>
                </div>
                
                <!-- Users List -->
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-medium text-gray-900">System Users</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created At</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Users will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- Close Ticket Modal -->
        <div id="closeTicketModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Close Ticket</h3>
                        <form id="closeTicketForm">
                            <input type="hidden" id="ticketIdToClose">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="closeReason">
                                    Close Reason*
                                </label>
                                <select id="closeReason" name="closeReason" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Reason</option>
                                    <option value="Closed without reminder">Closed without reminder</option>
                                    <option value="Closed after first reminder">Closed after first reminder</option>
                                    <option value="Closed after second reminder">Closed after second reminder</option>
                                    <option value="Closed after third reminder">Closed after third reminder</option>
                                    <option value="Closed due to no response after third reminder">Closed due to no response after third reminder</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="closeNotes">
                                    Notes
                                </label>
                                <textarea id="closeNotes" name="closeNotes" rows="3" 
                                          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="confirmCloseTicket" 
                                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Close Ticket
                        </button>
                        <button type="button" id="cancelCloseTicket" 
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reminder Modal -->
        <div id="reminderModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Set Reminder</h3>
                        <form id="reminderForm">
                            <input type="hidden" id="ticketIdForReminder">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="reminderType">
                                    Reminder Type*
                                </label>
                                <select id="reminderType" name="reminderType" required 
                                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Reminder</option>
                                    <option value="6h">6 Hours Reminder</option>
                                    <option value="24h">24 Hours Reminder</option>
                                    <option value="48h">48 Hours Reminder</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="reminderNotes">
                                    Notes
                                </label>
                                <textarea id="reminderNotes" name="reminderNotes" rows="3" 
                                          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" id="confirmSetReminder" 
                                class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                            Set Reminder
                        </button>
                        <button type="button" id="cancelSetReminder" 
                                class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Notification -->
        <div id="successNotification" class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-md shadow-lg hidden">
            <div class="flex items-center">
                <i class="fas fa-check-circle mr-2"></i>
                <span id="successMessage"></span>
            </div>
        </div>

        <!-- Error Notification -->
        <div id="errorNotification" class="fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-md shadow-lg hidden">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span id="errorMessage"></span>
            </div>
        </div>
    </div>

    <script>
        // Sample data storage (in a real app, this would be a database)
        let tickets = [];
        let users = [
            { username: 'Abdullah', password: 'A', role: 'admin', createdAt: new Date().toISOString() }
        ];
        let currentUser = null;
        let currentPage = 1;
        const itemsPerPage = 10;

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const currentUserSpan = document.getElementById('currentUser');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // Tabs
        const createTicketTab = document.getElementById('createTicketTab');
        const searchTicketTab = document.getElementById('searchTicketTab');
        const adminTab = document.getElementById('adminTab');
        const createTicketSection = document.getElementById('createTicketSection');
        const searchTicketSection = document.getElementById('searchTicketSection');
        const adminPanelSection = document.getElementById('adminPanelSection');
        
        // Ticket form
        const ticketForm = document.getElementById('ticketForm');
        const ticketNumberInput = document.getElementById('ticketNumber');
        const accountNameInput = document.getElementById('accountName');
        const platformSelect = document.getElementById('platform');
        const phoneNumberInput = document.getElementById('phoneNumber');
        const ticketDateInput = document.getElementById('ticketDate');
        const openTimeInput = document.getElementById('openTime');
        const ticketError = document.getElementById('ticketError');
        
        // Search form
        const searchForm = document.getElementById('searchForm');
        const searchTicketNumberInput = document.getElementById('searchTicketNumber');
        const searchPhoneNumberInput = document.getElementById('searchPhoneNumber');
        const searchAccountNameInput = document.getElementById('searchAccountName');
        const resetSearchBtn = document.getElementById('resetSearch');
        const searchResultsTableBody = document.getElementById('searchResultsTableBody');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const exportSearchResultsBtn = document.getElementById('exportSearchResults');
        
        // Admin panel
        const addUserForm = document.getElementById('addUserForm');
        const newUsernameInput = document.getElementById('newUsername');
        const newPasswordInput = document.getElementById('newPassword');
        const userRoleSelect = document.getElementById('userRole');
        const usersTableBody = document.getElementById('usersTableBody');
        const importTicketsForm = document.getElementById('importTicketsForm');
        const ticketsFileInput = document.getElementById('ticketsFile');
        const exportAllTicketsBtn = document.getElementById('exportAllTickets');
        
        // Tickets table
        const ticketsTableBody = document.getElementById('ticketsTableBody');
        const startCountSpan = document.getElementById('startCount');
        const endCountSpan = document.getElementById('endCount');
        const totalCountSpan = document.getElementById('totalCount');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        
        // Modals
        const closeTicketModal = document.getElementById('closeTicketModal');
        const closeTicketForm = document.getElementById('closeTicketForm');
        const ticketIdToCloseInput = document.getElementById('ticketIdToClose');
        const confirmCloseTicketBtn = document.getElementById('confirmCloseTicket');
        const cancelCloseTicketBtn = document.getElementById('cancelCloseTicket');
        
        const reminderModal = document.getElementById('reminderModal');
        const reminderForm = document.getElementById('reminderForm');
        const ticketIdForReminderInput = document.getElementById('ticketIdForReminder');
        const confirmSetReminderBtn = document.getElementById('confirmSetReminder');
        const cancelSetReminderBtn = document.getElementById('cancelSetReminder');
        
        // Notifications
        const successNotification = document.getElementById('successNotification');
        const successMessageSpan = document.getElementById('successMessage');
        const errorNotification = document.getElementById('errorNotification');
        const errorMessageSpan = document.getElementById('errorMessage');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Set default date and time
            const now = new Date();
            ticketDateInput.valueAsDate = now;
            openTimeInput.value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            // Check if user is already logged in (for demo purposes)
            if (localStorage.getItem('currentUser')) {
                currentUser = JSON.parse(localStorage.getItem('currentUser'));
                loginSuccess();
            }
            
            // Load sample data
            loadSampleData();
            renderTicketsTable();
            renderUsersTable();
        });

        // Login form submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Validate credentials
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                loginSuccess();
            } else {
                loginError.textContent = 'Invalid username or password';
                loginError.classList.remove('hidden');
            }
        });

        // Logout button
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            localStorage.removeItem('currentUser');
            appContainer.classList.add('hidden');
            loginScreen.classList.remove('hidden');
            loginForm.reset();
            loginError.classList.add('hidden');
        });

        // Tab switching
        createTicketTab.addEventListener('click', () => {
            createTicketTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            createTicketTab.classList.add('border-blue-500', 'text-blue-600');
            
            searchTicketTab.classList.remove('border-blue-500', 'text-blue-600');
            searchTicketTab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            
            adminTab.classList.remove('border-blue-500', 'text-blue-600');
            adminTab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            
            createTicketSection.classList.remove('hidden');
            searchTicketSection.classList.add('hidden');
            adminPanelSection.classList.add('hidden');
        });

        searchTicketTab.addEventListener('click', () => {
            searchTicketTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            searchTicketTab.classList.add('border-blue-500', 'text-blue-600');
            
            createTicketTab.classList.remove('border-blue-500', 'text-blue-600');
            createTicketTab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            
            adminTab.classList.remove('border-blue-500', 'text-blue-600');
            adminTab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            
            searchTicketSection.classList.remove('hidden');
            createTicketSection.classList.add('hidden');
            adminPanelSection.classList.add('hidden');
        });

        adminTab.addEventListener('click', () => {
            adminTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            adminTab.classList.add('border-blue-500', 'text-blue-600');
            
            createTicketTab.classList.remove('border-blue-500', 'text-blue-600');
            createTicketTab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            
            searchTicketTab.classList.remove('border-blue-500', 'text-blue-600');
            searchTicketTab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            
            adminPanelSection.classList.remove('hidden');
            createTicketSection.classList.add('hidden');
            searchTicketSection.classList.add('hidden');
        });

        // Ticket form submission
        ticketForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const ticketNumber = ticketNumberInput.value.trim();
            const accountName = accountNameInput.value.trim();
            const platform = platformSelect.value;
            const phoneNumber = phoneNumberInput.value.trim();
            const ticketDate = ticketDateInput.value;
            const openTime = openTimeInput.value;
            
            // Check if ticket number already exists
            if (tickets.some(t => t.ticketNumber === ticketNumber)) {
                ticketError.classList.remove('hidden');
                ticketNumberInput.focus();
                return;
            }
            
            // Create new ticket
            const newTicket = {
                id: generateId(),
                ticketNumber,
                accountName,
                platform,
                phoneNumber: phoneNumber || null,
                ticketDate,
                openTime,
                closeTime: null,
                reminder6h: false,
                reminder24h: false,
                reminder48h: false,
                status: 'Open',
                createdBy: currentUser.username,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            tickets.unshift(newTicket);
            renderTicketsTable();
            ticketForm.reset();
            
            // Reset date and time to current
            const now = new Date();
            ticketDateInput.valueAsDate = now;
            openTimeInput.value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            showSuccess('Ticket created successfully!');
        });

        // Ticket number validation
        ticketNumberInput.addEventListener('input', () => {
            if (tickets.some(t => t.ticketNumber === ticketNumberInput.value.trim())) {
                ticketError.classList.remove('hidden');
            } else {
                ticketError.classList.add('hidden');
            }
        });

        // Search form submission
        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            searchTickets();
        });

        // Reset search
        resetSearchBtn.addEventListener('click', () => {
            searchForm.reset();
            searchResultsTableBody.innerHTML = '';
            noResultsMessage.classList.remove('hidden');
        });

        // Export search results
        exportSearchResultsBtn.addEventListener('click', () => {
            const searchTicketNumber = searchTicketNumberInput.value.trim();
            const searchPhoneNumber = searchPhoneNumberInput.value.trim();
            const searchAccountName = searchAccountNameInput.value.trim();
            
            const filteredTickets = filterTickets(searchTicketNumber, searchPhoneNumber, searchAccountName);
            exportToExcel(filteredTickets, 'HM_Follow_Up_Search_Results');
        });

        // Add user form submission
        addUserForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const username = newUsernameInput.value.trim();
            const password = newPasswordInput.value;
            const role = userRoleSelect.value;
            
            // Check if username already exists
            if (users.some(u => u.username === username)) {
                showError('Username already exists');
                return;
            }
            
            // Add new user
            const newUser = {
                username,
                password,
                role,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            renderUsersTable();
            addUserForm.reset();
            
            showSuccess('User added successfully!');
        });

        // Import tickets
        importTicketsForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const file = ticketsFileInput.files[0];
            if (!file) {
                showError('Please select a file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // Get first sheet
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                
                // Convert to JSON
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                
                // Process imported tickets
                processImportedTickets(jsonData);
            };
            reader.readAsArrayBuffer(file);
        });

        // Export all tickets
        exportAllTicketsBtn.addEventListener('click', () => {
            exportToExcel(tickets, 'HM_Follow_Up_All_Tickets');
        });

        // Pagination
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderTicketsTable();
            }
        });

        nextPageBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(tickets.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTicketsTable();
            }
        });

        // Close ticket modal
        confirmCloseTicketBtn.addEventListener('click', () => {
            const ticketId = ticketIdToCloseInput.value;
            const closeReason = document.getElementById('closeReason').value;
            const closeNotes = document.getElementById('closeNotes').value;
            
            if (!closeReason) {
                showError('Please select a close reason');
                return;
            }
            
            // Find and update ticket
            const ticketIndex = tickets.findIndex(t => t.id === ticketId);
            if (ticketIndex !== -1) {
                const now = new Date();
                tickets[ticketIndex].closeTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                tickets[ticketIndex].status = closeReason;
                tickets[ticketIndex].updatedAt = new Date().toISOString();
                
                if (closeNotes) {
                    tickets[ticketIndex].closeNotes = closeNotes;
                }
                
                renderTicketsTable();
                if (!searchTicketSection.classList.contains('hidden')) {
                    searchTickets();
                }
                
                closeTicketModal.classList.add('hidden');
                showSuccess('Ticket closed successfully!');
            }
        });

        cancelCloseTicketBtn.addEventListener('click', () => {
            closeTicketModal.classList.add('hidden');
            closeTicketForm.reset();
        });

        // Reminder modal
        confirmSetReminderBtn.addEventListener('click', () => {
            const ticketId = ticketIdForReminderInput.value;
            const reminderType = document.getElementById('reminderType').value;
            const reminderNotes = document.getElementById('reminderNotes').value;
            
            if (!reminderType) {
                showError('Please select a reminder type');
                return;
            }
            
            // Find and update ticket
            const ticketIndex = tickets.findIndex(t => t.id === ticketId);
            if (ticketIndex !== -1) {
                if (reminderType === '6h') {
                    tickets[ticketIndex].reminder6h = true;
                } else if (reminderType === '24h') {
                    tickets[ticketIndex].reminder24h = true;
                } else if (reminderType === '48h') {
                    tickets[ticketIndex].reminder48h = true;
                }
                
                tickets[ticketIndex].updatedAt = new Date().toISOString();
                
                if (reminderNotes) {
                    tickets[ticketIndex].reminderNotes = reminderNotes;
                }
                
                renderTicketsTable();
                if (!searchTicketSection.classList.contains('hidden')) {
                    searchTickets();
                }
                
                reminderModal.classList.add('hidden');
                showSuccess('Reminder set successfully!');
            }
        });

        cancelSetReminderBtn.addEventListener('click', () => {
            reminderModal.classList.add('hidden');
            reminderForm.reset();
        });

        // Helper functions
        function loginSuccess() {
            loginScreen.classList.add('hidden');
            appContainer.classList.remove('hidden');
            currentUserSpan.textContent = currentUser.username;
            
            // Show admin tab if user is admin
            if (currentUser.role === 'admin') {
                adminTab.classList.remove('hidden');
            } else {
                adminTab.classList.add('hidden');
            }
            
            // Set default tab
            createTicketTab.click();
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function loadSampleData() {
            // Add some sample tickets if none exist
            if (tickets.length === 0) {
                const now = new Date();
                const sampleDate = new Date(now.getTime() - Math.random() * 30 * 24 * 60 * 60 * 1000);
                
                tickets = [
                    {
                        id: generateId(),
                        ticketNumber: 'TKT-' + Math.floor(1000 + Math.random() * 9000),
                        accountName: 'Customer One',
                        platform: 'X',
                        phoneNumber: '0555123456',
                        ticketDate: sampleDate.toISOString().split('T')[0],
                        openTime: '10:30',
                        closeTime: '14:45',
                        reminder6h: true,
                        reminder24h: true,
                        reminder48h: false,
                        status: 'Closed after second reminder',
                        createdBy: 'Abdullah',
                        createdAt: sampleDate.toISOString(),
                        updatedAt: sampleDate.toISOString()
                    },
                    {
                        id: generateId(),
                        ticketNumber: 'TKT-' + Math.floor(1000 + Math.random() * 9000),
                        accountName: 'Customer Two',
                        platform: 'Instagram',
                        phoneNumber: '0555654321',
                        ticketDate: now.toISOString().split('T')[0],
                        openTime: '09:15',
                        closeTime: null,
                        reminder6h: false,
                        reminder24h: false,
                        reminder48h: false,
                        status: 'Open',
                        createdBy: 'Abdullah',
                        createdAt: now.toISOString(),
                        updatedAt: now.toISOString()
                    }
                ];
            }
        }

        function renderTicketsTable() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedTickets = tickets.slice(startIndex, endIndex);
            
            ticketsTableBody.innerHTML = '';
            
            if (paginatedTickets.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="12" class="px-6 py-4 text-center text-sm text-gray-500">
                        No tickets found. Create your first ticket using the form above.
                    </td>
                `;
                ticketsTableBody.appendChild(row);
            } else {
                paginatedTickets.forEach(ticket => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    
                    // Format date for display
                    const ticketDate = new Date(ticket.ticketDate);
                    const formattedDate = ticketDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${tickets.indexOf(ticket) + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.ticketNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.accountName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.platform}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.openTime}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.closeTime || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${ticket.reminder6h ? '✅' : '❌'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${ticket.reminder24h ? '✅' : '❌'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${ticket.reminder48h ? '✅' : '❌'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${ticket.status.includes('Open') ? 'bg-green-100 text-green-800' : 
                                  ticket.status.includes('Closed') ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}">
                                ${ticket.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            ${ticket.status.includes('Open') ? `
                                <button class="text-blue-600 hover:text-blue-900 mr-3 set-reminder-btn" data-id="${ticket.id}">
                                    <i class="fas fa-bell"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-900 close-ticket-btn" data-id="${ticket.id}">
                                    <i class="fas fa-times-circle"></i>
                                </button>
                            ` : `
                                <span class="text-gray-400">
                                    <i class="fas fa-check-circle mr-3"></i>
                                    <i class="fas fa-times-circle"></i>
                                </span>
                            `}
                        </td>
                    `;
                    ticketsTableBody.appendChild(row);
                });
            }
            
            // Update pagination info
            startCountSpan.textContent = startIndex + 1;
            endCountSpan.textContent = Math.min(endIndex, tickets.length);
            totalCountSpan.textContent = tickets.length;
            
            // Disable/enable pagination buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = endIndex >= tickets.length;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.close-ticket-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const ticketId = e.currentTarget.getAttribute('data-id');
                    openCloseTicketModal(ticketId);
                });
            });
            
            document.querySelectorAll('.set-reminder-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const ticketId = e.currentTarget.getAttribute('data-id');
                    openReminderModal(ticketId);
                });
            });
        }

        function renderUsersTable() {
            usersTableBody.innerHTML = '';
            
            if (users.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">
                        No users found. Add your first user using the form above.
                    </td>
                `;
                usersTableBody.appendChild(row);
            } else {
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    
                    // Format date for display
                    const createdAt = new Date(user.createdAt);
                    const formattedDate = createdAt.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.username}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                                ${user.role.charAt(0).toUpperCase() + user.role.slice(1)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            ${user.username !== currentUser.username ? `
                                <button class="text-red-600 hover:text-red-900 delete-user-btn" data-username="${user.username}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            ` : `
                                <span class="text-gray-400">
                                    <i class="fas fa-trash-alt"></i>
                                </span>
                            `}
                        </td>
                    `;
                    usersTableBody.appendChild(row);
                });
            }
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-user-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const username = e.currentTarget.getAttribute('data-username');
                    if (confirm(`Are you sure you want to delete user ${username}?`)) {
                        deleteUser(username);
                    }
                });
            });
        }

        function searchTickets() {
            const ticketNumber = searchTicketNumberInput.value.trim();
            const phoneNumber = searchPhoneNumberInput.value.trim();
            const accountName = searchAccountNameInput.value.trim();
            
            const filteredTickets = filterTickets(ticketNumber, phoneNumber, accountName);
            renderSearchResults(filteredTickets);
        }

        function filterTickets(ticketNumber, phoneNumber, accountName) {
            return tickets.filter(ticket => {
                const matchesTicketNumber = ticketNumber ? ticket.ticketNumber.includes(ticketNumber) : true;
                const matchesPhoneNumber = phoneNumber ? (ticket.phoneNumber && ticket.phoneNumber.includes(phoneNumber)) : true;
                const matchesAccountName = accountName ? ticket.accountName.toLowerCase().includes(accountName.toLowerCase()) : true;
                
                return matchesTicketNumber && matchesPhoneNumber && matchesAccountName;
            });
        }

        function renderSearchResults(filteredTickets) {
            searchResultsTableBody.innerHTML = '';
            
            if (filteredTickets.length === 0) {
                noResultsMessage.classList.remove('hidden');
            } else {
                noResultsMessage.classList.add('hidden');
                
                filteredTickets.forEach(ticket => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    
                    // Format date for display
                    const ticketDate = new Date(ticket.ticketDate);
                    const formattedDate = ticketDate.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${tickets.indexOf(ticket) + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.ticketNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.accountName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.platform}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.openTime}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.closeTime || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${ticket.reminder6h ? '✅' : '❌'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${ticket.reminder24h ? '✅' : '❌'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${ticket.reminder48h ? '✅' : '❌'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${ticket.status.includes('Open') ? 'bg-green-100 text-green-800' : 
                                  ticket.status.includes('Closed') ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}">
                                ${ticket.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            ${ticket.status.includes('Open') ? `
                                <button class="text-blue-600 hover:text-blue-900 mr-3 set-reminder-btn" data-id="${ticket.id}">
                                    <i class="fas fa-bell"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-900 close-ticket-btn" data-id="${ticket.id}">
                                    <i class="fas fa-times-circle"></i>
                                </button>
                            ` : `
                                <span class="text-gray-400">
                                    <i class="fas fa-check-circle mr-3"></i>
                                    <i class="fas fa-times-circle"></i>
                                </span>
                            `}
                        </td>
                    `;
                    searchResultsTableBody.appendChild(row);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('.close-ticket-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const ticketId = e.currentTarget.getAttribute('data-id');
                        openCloseTicketModal(ticketId);
                    });
                });
                
                document.querySelectorAll('.set-reminder-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const ticketId = e.currentTarget.getAttribute('data-id');
                        openReminderModal(ticketId);
                    });
                });
            }
        }

        function openCloseTicketModal(ticketId) {
            ticketIdToCloseInput.value = ticketId;
            closeTicketForm.reset();
            closeTicketModal.classList.remove('hidden');
        }

        function openReminderModal(ticketId) {
            ticketIdForReminderInput.value = ticketId;
            reminderForm.reset();
            reminderModal.classList.remove('hidden');
        }

        function deleteUser(username) {
            users = users.filter(u => u.username !== username);
            renderUsersTable();
            showSuccess('User deleted successfully!');
        }

        function processImportedTickets(importedData) {
            let importedCount = 0;
            let duplicateCount = 0;
            
            importedData.forEach(item => {
                // Skip if required fields are missing
                if (!item['Ticket Number'] || !item['Account Name'] || !item['Platform'] || !item['Date'] || !item['Open Time']) {
                    return;
                }
                
                // Check if ticket already exists
                if (tickets.some(t => t.ticketNumber === item['Ticket Number'])) {
                    duplicateCount++;
                    return;
                }
                
                // Create new ticket
                const newTicket = {
                    id: generateId(),
                    ticketNumber: item['Ticket Number'],
                    accountName: item['Account Name'],
                    platform: item['Platform'],
                    phoneNumber: item['Phone Number'] || null,
                    ticketDate: item['Date'],
                    openTime: item['Open Time'],
                    closeTime: item['Close Time'] || null,
                    reminder6h: item['6h Reminder'] === '✅' || item['6h Reminder'] === true,
                    reminder24h: item['24h Reminder'] === '✅' || item['24h Reminder'] === true,
                    reminder48h: item['48h Reminder'] === '✅' || item['48h Reminder'] === true,
                    status: item['Status'] || 'Open',
                    createdBy: currentUser.username,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                tickets.unshift(newTicket);
                importedCount++;
            });
            
            renderTicketsTable();
            
            if (importedCount > 0 || duplicateCount > 0) {
                showSuccess(`Imported ${importedCount} tickets successfully. ${duplicateCount} duplicates skipped.`);
            } else {
                showError('No valid tickets found in the file');
            }
        }

        function exportToExcel(data, fileName) {
            // Prepare data for export
            const exportData = data.map(ticket => ({
                'ID': tickets.indexOf(ticket) + 1,
                'Ticket Number': ticket.ticketNumber,
                'Account Name': ticket.accountName,
                'Platform': ticket.platform,
                'Phone Number': ticket.phoneNumber || '',
                'Date': ticket.ticketDate,
                'Open Time': ticket.openTime,
                'Close Time': ticket.closeTime || '',
                '6h Reminder': ticket.reminder6h ? '✅' : '❌',
                '24h Reminder': ticket.reminder24h ? '✅' : '❌',
                '48h Reminder': ticket.reminder48h ? '✅' : '❌',
                'Status': ticket.status,
                'Created By': ticket.createdBy,
                'Created At': new Date(ticket.createdAt).toLocaleString(),
                'Updated At': new Date(ticket.updatedAt).toLocaleString()
            }));
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Tickets");
            
            // Generate file and download
            XLSX.writeFile(wb, `${fileName}_${new Date().toISOString().slice(0, 10)}.xlsx`);
            
            showSuccess('Export completed successfully!');
        }

        function showSuccess(message) {
            successMessageSpan.textContent = message;
            successNotification.classList.remove('hidden');
            
            setTimeout(() => {
                successNotification.classList.add('hidden');
            }, 3000);
        }

        function showError(message) {
            errorMessageSpan.textContent = message;
            errorNotification.classList.remove('hidden');
            
            setTimeout(() => {
                errorNotification.classList.add('hidden');
            }, 3000);
        }
    </script>
<p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - 🧬 <a href="https://enzostvs-deepsite.hf.space?remix=Ab100100/follow-up1" style="color: #fff;text-decoration: underline;" target="_blank" >Remix</a></p></body>
</html>